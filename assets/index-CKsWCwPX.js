(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const J=document.getElementById("file-input"),s=document.getElementById("audio-player"),Y=document.getElementById("play-pause"),Z=document.getElementById("next"),_=document.getElementById("prev"),W=document.getElementById("song-title"),p=document.getElementById("progress-bar"),H=document.getElementById("toggle-repeat"),ee=document.getElementById("repeat-icon"),B=document.getElementById("toggle-shuffle");document.getElementById("shuffle-icon");const R=document.getElementById("current-time"),X=document.getElementById("total-duration"),m=document.getElementById("album-art"),V=document.getElementById("blur-background"),z=document.querySelector(".player-container"),O=document.getElementById("song-artist"),F=document.querySelector(".song-list-container"),P=document.querySelector("#song-list-body"),u=document.getElementById("lyrics-overlay"),f=document.getElementById("lyrics-container");document.getElementById("lyrics-text");const $=document.getElementById("lyrics-icon"),te=document.getElementById("turn-lyrics"),ne=new ColorThief,j=["audio/mpeg","audio/wav","audio/ogg","audio/mp3","audio/flac","audio/aac"];let l=[],a=0,T=!1,N=null,S=!1,L=null,b=0,w=!1,y=[],d=[],C=-1,g=null,U=new Set;lucide.createIcons();z.classList.add("loading");setTimeout(()=>z.classList.remove("loading"),500);const q=localStorage.getItem("lastIndex");q!==null&&(a=parseInt(q));m.src="https://placehold.co/200x200?text=No+Cover";m.onerror=function(){console.warn("Error loading album art"),this.src="https://placehold.co/200x200?text=No+Cover",this.style.backgroundColor="#333"};B.style.opacity=.5;function ie(){U.forEach(e=>{if(e!==s.src)try{URL.revokeObjectURL(e)}catch(t){console.warn("Error revoking URL:",t)}}),U=new Set([s.src])}function oe(){l.forEach(e=>{window.jsmediatags.read(e.file,{onSuccess:function(n){e.title=n.tags.title||e.name,e.artist=n.tags.artist||"-",e.album=n.tags.album||"-",I(),D()},onError:function(){e.artist="-",e.album="-",I(),D()}});const t=new Audio;t.src=URL.createObjectURL(e.file),t.addEventListener("loadedmetadata",()=>{e.duration=t.duration,e.durationFormatted=E(e.duration),I(),URL.revokeObjectURL(t.src)})})}J.addEventListener("change",function(){const e=Array.from(this.files).filter(o=>j.includes(o.type)||o.name.endsWith(".lrc"));if(e.length===0){alert("No compatible audio files found"),l.length===0&&F.classList.add("hidden-list");return}F.classList.remove("hidden-list");const t=e.filter(o=>j.includes(o.type)),n=e.filter(o=>o.name.endsWith(".lrc"));ie();const r=t.map(o=>{const c=o.name.replace(/\.[^/.]+$/,""),A=n.find(x=>x.name.replace(/\.[^/.]+$/,"")===c);return{file:o,name:c,lrcFile:A||null,title:null,artist:null,album:null,duration:null,durationFormatted:null,ObjectUrl:null}}),i=l.length===0;l=l.concat(r),oe(),I(),i&&l.length>0&&(a=0,h())});function h(){l.length!==0&&(re(),se(),le(),ce())}function re(){p.value=0,R.textContent="00:00",X.textContent="00:00"}function se(){L&&(URL.revokeObjectURL(L),L=null)}function le(){if(a<0||a>=l.length){console.error("Invalid song index:",a);return}const e=l[a];if(!e||!e.file){console.error("Invalid song at the index:",a);return}localStorage.setItem("lastIndex",a),I();try{const t=URL.createObjectURL(e.file);s.src=t,U.add(t),L=t,W.textContent=e.name||"Unknown Song",s.load(),s.play().catch(n=>{console.error("Error playing audio:",n)}),v(!0)}catch(t){console.error("Error loading song:",t)}}function ae(e,t=null){const n=document.getElementById("file-format");if(!n||!(e!=null&&e.file))return;const r=e.file.type.split("/")[1].toUpperCase();let i=r;if(t!=null&&t.bitrate){if(["FLAC","WAV","ALAC"].includes(r))i+=" • Lossless";else{const o=Math.round(t.bitrate/1e3);i+=` • ${o}kbps`}n.classList.toggle("high-quality",t.bitrate>=32e4||["FLAC","WAV","ALAC"].includes(r))}else if(e.duration){const o=Math.round(e.file.size/(e.duration*.0075));o>1e3?i+=" • Lossless":i+=` • ~${o}kbps`}n.textContent=i}function ce(){const e=l[a];if(g&&(s.removeEventListener("timeupdate",g),g=null),e.lrcFile){const t=new FileReader;t.onload=function(n){M(n.target.result)},t.readAsText(e.lrcFile)}else de(e)}function de(e){window.jsmediatags.read(e.file,{onSuccess:function(t){console.log("Tags:",t.tags),t.tags.title&&(W.textContent=t.tags.title,e.title=t.tags.title),t.tags.artist?(O.textContent=t.tags.artist,e.artist=t.tags.artist):O.textContent="",t.tags.lyrics&&t.tags.lyrics.text?M(t.tags.lyrics.text):e.lrcFile||M("No lyrics found"),t.tags.picture?ue(t.tags.picture):(console.log("No picture data found in metadata"),k());const n={bitrate:t.tags.bitrate,sampleRate:t.tags.sampleRate,bitsPerSample:t.tags.bitsPerSample};ae(e,n)},onError:function(t){console.error("Error reading metadata:",t),k()}})}function ue(e,t){const n=me(e.data),r=`data:${e.format};base64,${n}`,i=new Image;i.crossOrigin="anonymous",i.onload=function(){m.onload=function(){m.style.opacity=1},m.onerror=k,m.src=r,V.style.backgroundImage=`url(${r})`,setTimeout(()=>{if(i.complete&&i.naturalWidth!==0){const o=ne.getColor(i);fe(o)}else G()},100)},i.onerror=k,i.src=r}function k(){m.src="https://placehold.co/200x200?text=No+Cover",m.style.opacity=1,V.style.backgroundImage="none",G(),L&&setTimeout(()=>{URL.revokeObjectURL(L)},1e3)}function G(){document.documentElement.style.setProperty("--theme-color","74, 144, 226")}function me(e){try{let t="";const n=new Uint8Array(e),r=n.byteLength,i=32768;for(let o=0;o<r;o+=i){const c=n.subarray(o,Math.min(o+i,r));t+=String.fromCharCode.apply(null,c)}return window.btoa(t)}catch(t){throw console.error("Error converting ArrayBuffer to Base64:",t),t}}function fe(e){(!e||!Array.isArray(e)||e.length<3)&&(console.error("Invalid RGB array:",e),e=[74,144,226]);const[t,n,r]=e,i=`${t}, ${n}, ${r}`;document.documentElement.style.setProperty("--theme-color",i)}function v(e){const t=document.querySelector(".play-icon");t&&(t.setAttribute("data-lucide",e?"pause":"play"),lucide.createIcons())}Y.addEventListener("click",function(){s.paused?(s.play(),v(!0)):(s.pause(),v(!1))});p.addEventListener("input",function(){if(!s.duration||isNaN(s.duration))return;T=!0;const t=this.value/100*s.duration;R.textContent=E(t),clearTimeout(N),N=setTimeout(()=>{s.currentTime=t},100)});p.addEventListener("mousedown",()=>{T=!0,S=!s.paused,S&&s.pause()});p.addEventListener("mouseup",()=>{if(!T)return;T=!1,clearTimeout(N);const e=p.value/100*s.duration;if(s.currentTime=e,S){const t=s.play();t!==void 0&&t.catch(n=>console.error("Playback resume error:",n))}});p.addEventListener("click",function(e){if(!s.duration||isNaN(s.duration))return;const t=this.getBoundingClientRect(),n=Math.min(Math.max((e.clientX-t.left)/t.width,0),1),r=n*s.duration;s.currentTime=r,this.value=n*100,R.textContent=E(r),S&&s.play().catch(i=>console.error("Error resuming playback:",i))});s.addEventListener("timeupdate",function(){if(T||!s.duration||isNaN(s.duration))return;const e=s.currentTime/s.duration*100;Math.abs(p.value-e)>.5&&(p.value=e),R.textContent=E(s.currentTime)});s.addEventListener("loadedmetadata",function(){!s.duration||isNaN(s.duration)||(X.textContent=E(s.duration))});s.addEventListener("play",()=>{v(!0),S=!0});s.addEventListener("pause",()=>{v(!1)});Z.addEventListener("click",()=>{l.length!==0&&(w?K():(a=(a+1)%l.length,h()))});_.addEventListener("click",()=>{l.length!==0&&(a=(a-1+l.length)%l.length,h())});H.addEventListener("click",()=>{b=(b+1)%3,pe()});B.addEventListener("click",()=>{w=!w,ye(),y=[]});function pe(){const e=["bi bi-repeat","bi bi-repeat","bi bi-repeat-1"];ee.className=e[b],H.style.opacity=b===0?.5:1}function ye(){w?B.style.opacity=1:B.style.opacity=.5}s.addEventListener("ended",ge);function ge(){b===2?he():w?K():be()?Le():b===1?ve():Ee()}function he(){s.currentTime=0,s.play()}function Le(){a++,h()}function K(){if(l.length===0)return;let e;if(l.length<=1)e=0;else{do e=Math.floor(Math.random()*l.length);while(e===a||y.includes(e));y.push(a),y.length>Math.floor(l.length/2)&&l.length>2?y.shift():y.length>l.length-1&&(y=[])}a=e,h()}function be(){return a<l.length-1}function ve(){a=0,h()}function Ee(){s.pause(),v(!1)}function E(e){if(isNaN(e)||e<0)return"00:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n<10?"0":""}${n}`}function I(){P.innerHTML="",l.forEach((e,t)=>{const n=document.createElement("tr");n.addEventListener("click",()=>{a=t,h()}),t===a?n.classList.add("active"):n.classList.remove("active");const r=document.createElement("td");r.textContent=t+1,n.appendChild(r);const i=document.createElement("td"),o=document.createElement("span");if(o.classList.add("list-song-title"),o.textContent=e.title||e.name||e.file.name,i.appendChild(o),e.artist&&e.artist!=="-"){const x=document.createElement("span");x.classList.add("list-song-artist"),x.textContent=e.artist,i.appendChild(document.createElement("br")),i.appendChild(x)}n.appendChild(i);const c=document.createElement("td");c.textContent=e.album||"-",n.appendChild(c);const A=document.createElement("td");A.textContent=e.durationFormatted||E(e.duration),n.appendChild(A),P.appendChild(n)}),xe()}function xe(){document.querySelectorAll("#song-list td").forEach(t=>{t.scrollWidth>t.clientWidth&&(t.title=t.textContent)})}function D(){document.querySelectorAll("#song-list td:nth-child(3)").forEach(t=>{const n=t.getAttribute("data-fulltext")||t.textContent,r=t.textContent.trim().split(/\s+/);r.length>4&&(t.textContent=r.slice(0,4).join(" ")+"...",t.setAttribute("title",n),t.setAttribute("data-fulltext",n))})}function Ce(){return window.innerWidth<=900||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function Q(){const e=Ce(),t=document.querySelector(".song-list-container");e?t.style.overflowX="auto":t.style.overflowX="hidden"}window.addEventListener("load",Q);window.addEventListener("resize",Q);function Ie(){u.classList.contains("visible")?(u.classList.remove("visible"),u.style.opacity="0",u.style.pointerEvents="none",u.style.transform="translateX(-50%) scale(0.95)",$.setAttribute("data-lucide","mic-vocal")):(u.classList.add("visible"),u.style.opacity="1",u.style.pointerEvents="auto",u.style.transform="translateX(-50%) scale(1)",$.setAttribute("data-lucide","mic")),lucide.createIcons()}te.addEventListener("click",Ie);function Te(e){return e.split(`
`).reduce((t,n)=>{const{timestamps:r,text:i}=Se(n);return[...t,...we(r,i)]},[]).sort((t,n)=>t.time-n.time)}function Se(e){const t=/\[(\d{2}):(\d{2}(?:\.\d{2})?)\]/g,n=[];let r,i=0;for(;(r=t.exec(e))!==null;){const o=parseInt(r[1]),c=parseFloat(r[2]);n.push(o*60+c),i=t.lastIndex}return{timestamps:n,text:e.substring(i).trim()}}function we(e,t){return e.length>0?e.map(n=>({time:n,text:t})):t?[{time:-1,text:t}]:[]}function M(e){f.innerHTML="",e.includes("[00:")||e.includes("[01:")?(d=Te(e),d.length>0?(d.forEach((n,r)=>{const i=document.createElement("p");i.textContent=n.text||"",i.setAttribute("data-time",n.time),i.classList.add("lyrics-line"),f.appendChild(i)}),Ae()):(f.textContent=e||"No lyrics available",d=[])):(f.textContent=e||"No lyrics available",d=[])}function Ae(){g&&s.removeEventListener("timeupdate",g);function e(n){const r=f.querySelectorAll(".lyrics-line");C!==-1&&r[C]&&r[C].classList.remove("active-line"),r[n]&&(r[n].classList.add("active-line"),C=n,t(r[n]))}function t(n){if(!n)return;const r=f.clientHeight,i=n.clientHeight,c=n.offsetTop-r/2+i/2;f.scrollTo({top:c,behavior:"smooth"})}g=function(){if(f.querySelectorAll(".lyrics-line").length===0||d.length===0)return;const r=s.currentTime;let i=-1;for(let o=0;o<d.length;o++)if(r>=d[o].time){if(o+1<d.length&&r<d[o+1].time){i=o;break}else if(o===d.length-1){i=o;break}}i!==-1&&i!==C&&e(i)},s.addEventListener("timeupdate",g)}
